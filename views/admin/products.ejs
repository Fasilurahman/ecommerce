<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Essence of Heaven</title>

    <!-- Custom fonts for this template -->
    <link href="/startbootstrap-sb-admin-2-gh-pages/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/startbootstrap-sb-admin-2-gh-pages/css/sb-admin-2.min.css" rel="stylesheet">

    <!-- Custom styles for this page -->
    <link href="/startbootstrap-sb-admin-2-gh-pages/vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>

    
    <style>
        .pagination {
    display: flex;
    justify-content: center;
}

.page-item {
    margin: 0 5px;
}

.page-item .page-link {
    color: #007bff;
    border: 1px solid #dee2e6;
    padding: 8px 12px;
    text-decoration: none;
    border-radius: 5px;
    transition: background-color 0.3s;
}

.page-item.active .page-link {
    background-color: #007bff;
    color: white;
    border-color: #007bff;
}

.page-item.disabled .page-link {
    pointer-events: none;
    opacity: 0.5;
}

        /* Additional styles for table and modal */
        .modal-dialog {
            max-width: 800px;
        }

        .modal-content {
            border-radius: 0.5rem;
        }

        .table-bordered td, .table-bordered th {
            padding: 0.75rem;
            border: 1px solid #dee2e6;
        }

        .product-image {
            width: 50px;
            height: auto;
        }
        .variant-item {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        .variant-item:hover {
            background-color: #e9ecef;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .variant-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .variant-details p {
            margin: 0;
        }
    </style>

    

</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-laugh-wink"></i>
                </div>
                <div class="sidebar-brand-text mx-3"><sup>ESSENCE OF HEAVEN</sup></div>
            </a>

            <!-- Divider -->
            <hr class="sidebar-divider my-0">

            <!-- Nav Item - Dashboard -->
            <li class="nav-item active">
                <a class="nav-link" href="/admin/dashboard">
                    <i class="fas fa-fw fa-tachometer-alt"></i>
                    <span>Dashboard</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <li class="nav-item">
                <a class="nav-link " href="/admin/sales-report" data-toggle="" data-target="#collapseTwo"
                    aria-expanded="true" aria-controls="collapseTwo">
                    <span>Sales report</span>
                </a>
            </li>

            <!-- Nav Item - Utilities Collapse Menu -->
            <li class="nav-item">
                <a class="nav-link  " href="/admin/users" data-toggle="" data-target="#collapseUtilities"
                    aria-expanded="true" aria-controls="">
                    <span>Users</span>
                </a>
            </li>

            <!-- Nav Item - Pages Collapse Menu -->
            <li class="nav-item">
                <a class="nav-link collapsed" href="/admin/products" data-toggle="" data-target="#collapsePages"
                    aria-expanded="true" aria-controls="collapsePages">
                    <span>Product</span>
                </a>
            </li>

            <li class="nav-item" >
                <a class="nav-link collapsed" href="/admin/brand" data-toggle="" data-target="#collapsePages"
                    aria-expanded="true" aria-controls="collapsePages">
                    <span>Brand</span>
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link collapsed" href="/admin/coupon" data-toggle="" data-target="#collapsePages"
                    aria-expanded="true" aria-controls="collapsePages" style="color: rgba(255, 255, 255, 0.8);">
                    <span>Coupon</span>
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link collapsed" href="/admin/offer" data-toggle="" data-target="#collapsePages"
                    aria-expanded="true" aria-controls="collapsePages" style="color: rgba(255, 255, 255, 0.8);">
                    <span>Offers</span>
                </a>
            </li>
            
            

            <!-- Nav Item - Charts -->
            <li class="nav-item">
                <a class="nav-link" href="/admin/order">
                    <span>Orders</span></a>
            </li>

            <!-- Nav Item - Tables -->
            
            <li class="nav-item">
                <a class="nav-link  " href="/admin/category" data-toggle="" data-target="#collapseUtilities"
                    aria-expanded="true" aria-controls="">
                    <span>category</span>
                </a>
            
            

            <!-- Divider -->
            <hr class="sidebar-divider d-none d-md-block">

            <a class="nav-link collapsed" href="/admin/logout" data-toggle="" data-target="#collapsePages"
                aria-expanded="true" aria-controls="collapsePages">
                <span>Logout</span>
            </a>

            <!-- Sidebar Toggler (Sidebar) -->
            <div class="text-center d-none d-md-inline">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </div>

            <!-- Sidebar Message -->
            

        </ul>

                </nav>
              <!-- End of Topbar -->
              <div class="container">
                <h2 class="mt-5">Product List</h2>
            
                <!-- Add Product Button -->
                <a href="/admin/addProduct" class="btn btn-success mb-3">Add Product</a>
            
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Brand</th>
                            <th>Variants</th>
                            <th>Status</th> <!-- Add Status Column -->
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% products.forEach(product => { %>
                            <tr id="product-<%= product._id %>">
                                <td><%= product.name %></td>
                                <td><%= product.description %></td>
                                <td><%= product.brand ? product.brand.brandName : 'No Brand' %></td>
                                <td>
                                    <% if (product.variants && product.variants.length > 0) { %>
                                        <% product.variants.forEach((variant, index) => { %>
                                            <div class="variant-item">
                                                <div class="variant-title">Variant <%= index + 1 %>:</div>
                                                <div class="variant-details">
                                                    <p><strong>Quantity:</strong> <%= variant.quantity %></p>
                                                    <p><strong>Price:</strong> $<%= variant.price.toFixed(2) %></p>
                                                    <p><strong>Stock:</strong> <%= variant.stock %></p>
                                                </div>
                                            </div>
                                        <% }) %>
                                    <% } else { %>
                                        <p>No variants available.</p>
                                    <% } %>
                                </td>
                                <td>
                                    <% if (product.status === 'active') { %>
                                        <span class="badge badge-success">Active</span>
                                    <% } else { %>
                                        <span class="badge badge-danger">Blocked</span>
                                    <% } %>
                                </td>
                                <td>
                                    <a href="/admin/editProduct/<%= product._id %>" class="btn btn-primary btn-sm">Edit</a>
                                    <!-- Block/Unblock buttons -->
                                    <% if (product.status === 'active') { %>
                                        <button class="btn btn-warning btn-sm block-btn" data-id="<%= product._id %>">Block</button>
                                    <% } else { %>
                                        <button class="btn btn-success btn-sm unblock-btn" data-id="<%= product._id %>">Unblock</button>
                                    <% } %>
                                    <!-- Delete button with AJAX -->
                                    <button class="btn btn-danger btn-sm delete-btn" data-id="<%= product._id %>">Delete</button>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
                
                
                <div class="pagination d-flex justify-content-center">
                    <ul class="pagination">
                        <!-- Previous button, disabled if on the first page -->
                        <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                            <a class="page-link" href="/admin/products?page=<%= currentPage - 1 %>&limit=<%= limit %>">Previous</a>
                        </li>
                
                        <!-- Show page numbers -->
                        <% for (let i = 1; i <= totalPages; i++) { %>
                            <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                                <a class="page-link" href="/admin/products?page=<%= i %>&limit=<%= limit %>"><%= i %></a>
                            </li>
                        <% } %>
                
                        <!-- Next button, disabled if on the last page -->
                        <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                            <a class="page-link" href="/admin/products?page=<%= currentPage + 1 %>&limit=<%= limit %>">Next</a>
                        </li>
                    </ul>
                </div>
                
                  
            </div>
            
            

<!-- End of Page Wrapper -->

<!-- Scroll to Top Button -->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>


<script>
     document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.delete-btn').forEach(button => {
            button.addEventListener('click', function() {
                const productId = this.getAttribute('data-id');
                const row = this.closest('tr'); 

                // Show confirmation dialog
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // If confirmed, proceed with the deletion
                        fetch(`/admin/products/${productId}`, {
                            method: 'DELETE',
                        })
                        .then(response => {
                            if (response.ok) {
                                row.remove(); // Remove the row from the table
                                Swal.fire('Deleted!', 'Your product has been deleted.', 'success');
                            } else {
                                Swal.fire('Error!', 'Failed to delete product.', 'error');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            Swal.fire('Error!', 'Error deleting product', 'error');
                        });
                    }
                });
            });
        });
    });
</script>

    <!-- Bootstrap core JavaScript-->
    <script src="/startbootstrap-sb-admin-2-gh-pages/vendor/jquery/jquery.min.js"></script>
    <script src="/startbootstrap-sb-admin-2-gh-pages/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="/startbootstrap-sb-admin-2-gh-pages/vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="/startbootstrap-sb-admin-2-gh-pages/js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="/startbootstrap-sb-admin-2-gh-pages/vendor/datatables/jquery.dataTables.min.js"></script>
    <script src="/startbootstrap-sb-admin-2-gh-pages/vendor/datatables/dataTables.bootstrap4.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="/startbootstrap-sb-admin-2-gh-pages/js/demo/datatables-demo.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Block product
            const blockButtons = document.querySelectorAll('.block-btn');
            blockButtons.forEach(button => {
                button.addEventListener('click', async function () {
                    const productId = this.getAttribute('data-id');
                    // SweetAlert confirmation dialog
                    const result = await Swal.fire({
                        title: 'Are you sure?',
                        text: "Do you want to block this product?",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Yes, block it!',
                        cancelButtonText: 'Cancel'
                    });
    
                    if (result.isConfirmed) {
                        fetch(`/admin/blockProduct/${productId}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                Swal.fire(
                                    'Blocked!',
                                    'The product has been blocked successfully.',
                                    'success'
                                ).then(() => location.reload()); // Reload the page after success
                            } else {
                                Swal.fire(
                                    'Error',
                                    'Failed to block the product. Please try again.',
                                    'error'
                                );
                            }
                        })
                        .catch(err => {
                            console.error(err);
                            Swal.fire(
                                'Error',
                                'There was a problem with the request.',
                                'error'
                            );
                        });
                    }
                });
            });
    
            // Unblock product
            const unblockButtons = document.querySelectorAll('.unblock-btn');
            unblockButtons.forEach(button => {
                button.addEventListener('click', async function () {
                    const productId = this.getAttribute('data-id');
                    // SweetAlert confirmation dialog
                    const result = await Swal.fire({
                        title: 'Are you sure?',
                        text: "Do you want to unblock this product?",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Yes, unblock it!',
                        cancelButtonText: 'Cancel'
                    });
    
                    if (result.isConfirmed) {
                        fetch(`/admin/unblockProduct/${productId}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                Swal.fire(
                                    'Unblocked!',
                                    'The product has been unblocked successfully.',
                                    'success'
                                ).then(() => location.reload()); // Reload the page after success
                            } else {
                                Swal.fire(
                                    'Error',
                                    'Failed to unblock the product. Please try again.',
                                    'error'
                                );
                            }
                        })
                        .catch(err => {
                            console.error(err);
                            Swal.fire(
                                'Error',
                                'There was a problem with the request.',
                                'error'
                            );
                        });
                    }
                });
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    

</body>

</html>